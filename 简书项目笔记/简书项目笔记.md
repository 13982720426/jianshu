# 简书项目笔记

如果前期环境已经弄好，直接看第六步项目建立初始文件

## 一.安装react脚手架工具

选择合适的文件夹输入cmd，回车打开命令行

![](E:\前端自学\笔记\简书项目笔记\imgs\屏幕截图 2021-01-20 134601.png)

```JavaScript
//安装脚手架工具
npm install -g create-react-app
```

## 二.创建自己的项目文件

```javascript
//创建自己的项目 my-app为自己的demo名称
create-react-app my-app
```

三.定位到项目并启动

在命令行里输入

```JavaScript
//定位到你的的项目下
cd my-app
```

然后再输入 

```
//自动开启应用服务器，并打开默认浏览器
npm start
```

- npm start 自动开启应用服务器，并打开默认浏览器；
- npm test：运行 Jest 测试
- npm run build：打包应用（准备上线）

命令行显示这样就创建成功了，

![](E:\前端自学\笔记\简书项目笔记\imgs\屏幕截图 2021-01-20 135402.png)

浏览器会打开默认的地址

![](E:\前端自学\笔记\简书项目笔记\imgs\image-20210120135958680.png)

如果遇到服务器地址localhost:3000被占用，重新选择一个地址打开或者覆盖3000即可

## 三.项目目录结构说明

运行命令以后，就会在运行命令所在目录下面创建一个以项目名称为名的目录

- node_modules目录：存放第三方依赖包
- public目录：存放静态文件，如项目中的index.html文件。
- src目录：最重要的文件
- index.js：入口文件

## 四.命令脚本

create-react-app 同时也提供了其它一些命令来帮助我们进行开发

- npm start：启动一个内置的本地 WebServer，根目录映射到 './public' 目录，默认端口：3000
- npm test：运行 Jest 测试
- npm run build：打包应用（准备上线），打包主要代码

最后会通过编译webpark自动去编译打包JS，通过npm run build命令自动打包，并以插入方式生成bulid文件夹。

![](E:\前端自学\笔记\简书项目笔记\imgs\20191015150741660.png)

![](E:\前端自学\笔记\简书项目笔记\imgs\20191015150838780.png)

bulid目录下的文件是真正在线上运行的代码。

## 五.vscode React 快速生成代码块

利用好插件能够方便我们的开发也能提高我们的效率和准确性，简单说下react快速生成代码块

![](E:\前端自学\笔记\简书项目笔记\imgs\20200423210659599.png)

在vscode中找到并安装这个插件
编写代码**rcc+tab键**就可以生成有状态的组件代码块

```javascript
import React, { Component } from 'react'

export default class Home extends Component {
    render() {
        return (
            <div>
                
            </div>
        )
    }
}
```

编写代码**rfc+tab键**就可以生成无状态的组件代码块

```javascript
import React from 'react'

export default function Home() {
    return (
        <div>
            
        </div>
    )
}
```



## 六.简书项目

### 1.初始文件搭建

1.其他文件夹不动，src文件夹只留这两个文件，再新建一个style.js

![image-20210120154550729](E:\前端自学\笔记\简书项目笔记\imgs\image-20210120154550729.png)

index.js

```javascript
import React from 'react'
import ReactDOM from 'react-dom'
import App from './App'

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById('root')
)
```

App.js

```javascript
import React, { Component } from 'react'

class App extends Component {
  render() {
    return <div>hello world</div>
  }
}
export default App
```

### 2.第三方样式化组件模块安装 

打开终端输入

```JavaScript
npm add styled-components
```

styled-components 样式化组件，主要作用是它可以编写实际的CSS代码来设计组件样式，也不需要组件和样式之间的映射，即创建后就是一个正常的React 组件，并且可以附加样式给当前组件，优化react组件

并在index.js中引用`import './style.js'`

因为是网页版需要统一浏览器网页格式，百度reset.css或者下边链接可以找到以下代码

[reset.css]: https://meyerweb.com/eric/tools/css/reset/

style.js

```javascript
import { createGlobalStyle } from 'styled-components'

export const GlobalStyle = createGlobalStyle`
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 100%;
	font: inherit;
	vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
	display: block;
}
body {
	line-height: 1;
}
ol, ul {
	list-style: none;
}
blockquote, q {
	quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
	content: '';
	content: none;
}
table {
	border-collapse: collapse;
	border-spacing: 0;
}
`
```

这就完成了初始文件的搭建

### 3.头部文件

#### 1）建立头部文件

1.在src文件夹下建立一个公共文件夹commom，并在commom下建立一个头部文件夹header

2.在haeader文件夹下建立入口文件index.js文件和样式文件style.js

3.在commom文件夹下建立一个静态文件夹statics，存放图片 图标不改变的文件

index.js

```javascript
import React, { Component } from 'react'
import {
  HeaderWarpper,
  Logo,
  Nav,
  NavItem,
  NavSearch,
  Addition,
  Button,
  SearchWrapper,
} from './style'
class Header extends Component {
  render() {
    return (
      <HeaderWarpper>
        <Logo />
        <Nav>
          <NavItem className="left active">首页</NavItem>
          <NavItem className="left">下载App</NavItem>
          <NavItem className="right">登录</NavItem>
          <NavItem className="right"></NavItem>
          <SearchWrapper>
            <NavSearch></NavSearch>
          </SearchWrapper>
        </Nav>
        <Addition>
          <Button className="writting">
            写文章
          </Button>
          <Button className="reg">注册</Button>
        </Addition>
      </HeaderWarpper>
    )
  }
}
export default Header

```

style.js中头文件

```JavaScript
import styled from 'styled-components'
import logPic from '../../statics/nav-logo.png'//图片文件位置
```

自定义标签，

index.js文件中导入这里对应建立的自定义标签

```JavaScript
import styled from 'styled-components'
import logPic from '../../statics/nav-logo.png' //图片文件位置

export const HeaderWarpper = styled.div`
  position: relative;
  height: 58px;
  border-bottom: 1px solid #f0f0f0;
`
export const Logo = styled.a.attrs({
  href: '/', //a标签的属性，跳转到首页
})`
  position: absolute;
  top: 0;
  left: 0;
  display: block;
  width: 100px;
  height: 58px;
  background: url(${logPic}); //这里是导入图片的写法
  background-size: contain;
`
export const Nav = styled.div`
  width: 960px;
  height: 100%;
  padding-right: 70px;
  box-sizing: border-box;
  margin: 0 auto;
`
export const NavItem = styled.div`
  line-height: 56px;
  padding: 0 15px;
  font-size: 17px;
  color: #333;
  &.left {
    float: left;
  }
  &.right {
    float: right;
    color: #969696;
  }
  &.active {
    color: #ea6f5a;
  }
`
export const NavSearch = styled.input.attrs({
  placeholder: '搜索',
})`
  width: 160px;
  height: 38px;
  padding: 0 30px 0 20px;
  margin-top: 10px;
  margin-left: 20px;
  box-sizing: border-box;
  border: none;
  outline: none;
  border-radius: 19px;
  background: #eee;
  font-size: 14px;
  color: #666
  &::placeholder {
    color: #999;
  }
`
export const Addition = styled.div`
  position: absolute;
  right: 0;
  top: 0;
  height: 58px;
`
export const Button = styled.div`
  float: right;
  margin-top: 10px;
  margin-right: 20px;
  padding: 0 20px;
  line-height: 38px;
  border-radius: 19px;
  border: 1px solid #ea6f5a;
  font-size: 14px;
  &.reg {
    color: #ea6f5a;
  }
  &.writting {
    color: #fff;
    background: #ea6f5a;
  }
`
export const SearchWrapper = styled.div`
  float: left;
  position: relative;
  .iconfont {
    position: absolute;
    right: 5px;
    bottom: 4px;
    width: 30px;
    line-height: 30px;
    border-radius: 15px;
    text-align: center;
  }
`

```

如果标签需要添加属性用`.attrs({})`

```javascript
export const NavSearch = styled.input.attrs({
  placeholder: '搜索',
})`

`
```

在index.js文件中有className的

```JavaScript
<NavItem className="left active">首页</NavItem>
<span className="iconfont">&#xe636;</span>
```

则在style.js中以这种方式修改样式

样式与它前面个div或者input框同级时用&符号

```JavaScript
 &.left { float: left;}

 &.active {color: #ea6f5a;}

 &::placeholder { color: #999;}

 .iconfont {
  position: absolute;
  right: 5px;
  bottom: 3px;
  width: 30px;
  line-height: 30px;
  border-radius: 15px;
  text-align: center;
 }
```



#### 2）加入iconfont图标库

React中用styled-components组件加入iconfont。

具体下载iconfont图库就不详解了

iconfont重要六个文件放入静态文件夹新建一个iconfont文件夹，`iconfont.css`改成`iconfont.js`

<img src="E:\前端自学\笔记\简书项目笔记\imgs\image-20210121152052051.png" alt="image-20210121152052051" style="zoom:80%;" />

`iconfont.js` 最后的文件不要，只留这两个 并且修改写法 头文件加入

```JavaScript
import { createGlobalStyle } from 'styled-components'
```

并把其他文件写入

```javascript
export const IconfontStyle = createGlobalStyle`


`
```

![image-20210121150444767](E:\前端自学\笔记\简书项目笔记\imgs\image-20210121150444767.png)



然后在需要用到的地方src\common\header\index.js 加入

```JavaScript
<span className="iconfont">&#xe636;</span>
```

![image-20210121151400139](E:\前端自学\笔记\简书项目笔记\imgs\image-20210121151400139.png)



最后图标需要全局使用，

在App.sj文件中加入

```JavaScript
import { IconfontStyle } from './statics/iconfont/iconfont.js'
```

```JavaScript
<IconfontStyle />
```

![image-20210121151810798](E:\前端自学\笔记\简书项目笔记\imgs\image-20210121151810798.png)

#### 3）加入搜索动画

安装动画插件

```JavaScript
npm install react-transition-group --save
```

在header文件夹下index.js中导入

`import { CSSTransition } from 'react-transition-group'`

并在收缩框中加入动画标签

```JavaScript
<CSSTransition
in={this.state.focused}focused
timeout={200}
classNames="slide"
>
```

给搜索框和放大镜图标绑定聚焦和失焦事件

![image-20210123193543756](E:\前端自学\笔记\简书项目笔记\imgs\image-20210123193543756.png)

事件函数

```JavaScript
  handleInputFocus() {
    this.setState({
      focused: true,
    })
  }
  handleInputBlur() {
    this.setState({
      focused: false,
    })
  }
```

在style.js文件夹中添加动画进出场效果

在搜索框样式中添加focused为真时的效果

![image-20210121191936320](E:\前端自学\笔记\简书项目笔记\imgs\image-20210121191936320.png)

### 4.使用React-Redux进行数据管理

react基本使用教程可以参考一下

[*Redux* 入门教程(一):基本用法 - 阮一峰的网络日志](https://www.baidu.com/link?url=0JEczCQkE_6BkaoYDHmHc7L7EUfww0m2eOCM1Hhp9Hav1BQCNF06oYYsBjPXD4QfoYsmJGXngzqKDGyrR-xdQ083EuRbV4RBtK02C7nb-PGzspY_fnq7Lx8jUPEoEAi-&wd=&eqid=a6dc13b40003e7ed0000000560096b3a)

#### 1）安装`redux`和`react-redux`和开发者工具redux-devtools-extension

```JavaScript
npm install redux
npm i redux react-redux --save-dev
```

在src文件夹下建立store文件夹，并在store文件夹下建立index.js和reducer.js

在App.js文件中调用

```JavaScript
import store from './store'
import { Provider } from 'react-redux'
```

并且在App组件中添加`<Provider>`标签

```JavaScript
class App extends Component {
  render() {
    return (
      <Provider store={store}>
        <Header />
        <IconfontStyle />
        <GlobalStyle />
      </Provider>
    )
  }
}
export default App
```

在src下的store文件夹下的index.js中创建store，并且引入开发者工具

[redux-devtools-extension](https://github.com/zalmoxisus/redux-devtools-extension)

```JavaScript
import { createStore, compose } from 'redux'
import reducer from './reducer'
const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose

const store = createStore(reducer, composeEnhancers())

export default store
```

在srcs下的store文件夹下reducer.js中只能写纯函数，

```javascript
const defaultState = {
  focused: false,
}
export default (state = defaultState, action) => {
  if (action.type === 'search_focus') {
    return {
      focused: true,
    }
  }
  if (action.type === 'search_blur') {
    return {
      focused: false,
    }
  }
  return state
}
```

在header文件夹下的index.js中

导入react-redux，并将`Header`与`mapStateToProps`, `mapDispathToProps`,建立映射关系

```JavaScript
import React from 'react'
import { connect } from 'react-redux' //建立连接
import { CSSTransition } from 'react-transition-group'

import {
  HeaderWarpper,
  Logo,
  Nav,
  NavItem,
  NavSearch,
  Addition,
  Button,
  SearchWrapper,
} from './style'

const mapStateToProps = (state) => {
  return {
    focused: state.focused,
  }
}
const mapDispathToProps = (dispath) => {
  return {
    handleInputFocus() {
      const action = {
        type: 'search_focus',
      }
      dispath(action)
    },
    handleInputBlur() {
      const action = {
        type: 'search_blur',
      }
      dispath(action)
    },
  }
}
export default connect(mapStateToProps, mapDispathToProps)(Header)
```

将Header改写成无状态组件，删去this绑定

```JavaScript
//class Header extends Component {}改成无状态组件提升性能
const Header = (props) => {
  return (
    <HeaderWarpper>
      <Logo />
      <Nav>
        <NavItem className="left active">首页</NavItem>
        <NavItem className="left">下载App</NavItem>
        <NavItem className="right">登录</NavItem>
        <NavItem className="right">
          <span className="iconfont">&#xe636;</span>
        </NavItem>
        <SearchWrapper>
          <CSSTransition in={props.focused} timeout={200} classNames="slide">
            <NavSearch
              className={props.focused ? 'focused' : ''}
              onFocus={props.handleInputFocus}
              onBlur={props.handleInputBlur}
            ></NavSearch>
          </CSSTransition>
          <span className={props.focused ? 'focused iconfont' : 'iconfont'}>
            &#xe614;
          </span>
        </SearchWrapper>
      </Nav>
      <Addition>
        <Button className="writting">
          <span className="iconfont">&#xe708;</span>
          写文章
        </Button>
        <Button className="reg">注册</Button>
      </Addition>
    </HeaderWarpper>
  )
}
```

#### 2）对数据进行拆分、管理

##### 1.使用`combineReducers`对reducer下的数据进行拆分管理

在src\common\header下建立一个store文件夹，并建立一个index.js和reducer.js

先在src\common\header\store\reducer.js中将原来src\store\reducer.js的程序剪切过来

然后src\common\header\store\index.js将reducer文件导出去

src\common\header\store\index.js

```JavaScript
import reducer from './reducer'

export { reducer }
```

原来的src\store\reducer.js将拆分的小reducer.js文件进行整合管理

```javascript
import { combineReducers } from 'redux'
import { reducer as headerReducer } from '../common/header/store'

const reducer = combineReducers({
  header: headerReducer,
})
export default reducer
```

由于原来的reducer文件拆分到了header文件夹下，在src\common\header\index.js中的`mapStateToProps`映射的地址要改变，加入header

```JavaScript
const mapStateToProps = (state) => {
  return {
    focused: state.header.focused,
  }
}
```

##### 2.使用actionCreators和actionTypes对数据进行拆分

在src\common\header\store文件夹下建立两个文件`actionCreators.js`和`actionTypes.js`

在actionTypes.js中

```JavaScript
export const SEARCH_FOCUS = 'header/SEARCH_FOCUS'
export const SEARCH_BLUR = 'header/SEARCH_BLUR'
```

在actionCreators.js中

```JavaScript
import * as actionTypes from './actionTypes'

export const searchFocus = () => ({
  type: actionTypes.SEARCH_FOCUS,
})
export const searchBlur = () => ({
  type: actionTypes.SEARCH_BLUR,
})

```

然后在src\common\header\store\index.js的入口文件中，将`actionCreators`和`actionTypes`导出

```JavaScript
import reducer from './reducer'
import * as actionTypes from './actionTypes'
import * as actionCreators from './actionCreators'

export { reducer, actionTypes, actionCreators }
```

在src\common\header\store\reducer.js中用`actionTypes.SEARCH_FOCUS`,`actionTypes.SEARCH_BLUR`将原来的`search_focus`,`search_blur`替换

```javascript
import * as actionTypes from './actionTypes'

const defaultState = {
  focused: false,
}

export default (state = defaultState, action) => {
  if (action.type === actionTypes.SEARCH_FOCUS) {
    return {
      focused: true,
    }
  }
  if (action.type === actionTypes.SEARCH_BLUR) {
    return {
      focused: false,
    }
  }
  return state
}

```

在src\common\header\index.js中导入

```JavaScript
import { actionCreators } from './store'
```

并且修改`mapDispathToProps`的派遣地址

```JavaScript
const mapDispathToProps = (dispath) => {
  return {
    handleInputFocus() {
      dispath(actionCreators.searchFocus())
    },
    handleInputBlur() {
      dispath(actionCreators.searchBlur())
    },
  }
}
```

##### 3.使用immutable来管理store

安装[immutable](https://github.com/immutable-js/immutable-js )库

```JavaScript
npm install immutable
```

在src\common\header\store\reducer.js中导入`immutable`库的`fromJS`方法

```JavaScript
import { fromJS } from 'immutable'
```

//将js对象转化成immutabl对象

```JavaScript
//将js对象转化成immutabl对象
const defaultState = fromJS({
  focused: false,
})
```

然后将return state的写法改成immutable的set方法

```JavaScript
export default (state = defaultState, action) => {
  if (action.type === actionTypes.SEARCH_FOCUS) {
    //immutable对象的set方法，会结合之前的immutable对象的值和设置的值，返回一个全新的对象
    return state.set('focused', true)
  }
  if (action.type === actionTypes.SEARCH_BLUR) {
    return state.set('focused', false)
  }
  return state
}
```

在src\common\header\index.js中将`mapStateToProps`改成immutable的get方法

```JavaScript
const mapStateToProps = (state) => {
  return {
    focused: state.header.get('focused'),
  }
}
```

#### 3）使用redux-rmmutable统一数据格式

安装`redux-immutable`

```JavaScript
 npm install redux-immutable --save
```

在src\store\reducer.js中将`redux`改成`redux-immutable`导入

```javascript
//import { combineReducers } from 'redux'
import { combineReducers } from 'redux-immutable'
```

然后在src\common\header\index.js将`mapStateToProps`中的`immutable`对象改成数组写法

```JavaScript
const mapStateToProps = (state) => {
  return {
    focused: state.getIn(['header', 'focused']),
  }
}
```

### 5.热门搜索样式布局

在src\common\header\index.js中新建一个函数，并在头文件调用对应的标签

```JavaScript
import {
  HeaderWarpper,
  Logo,
  Nav,
  NavItem,
  NavSearch,
  Addition,
  Button,
  SearchWrapper,
  SearchInfo,
  SearchInfoTitle,
  SearchInfoSwitch,
  SearchInfoItem,
  SearchInfoList,
} from './style'

const getListArea = (show) => {
  if (show) {
    return (
      <SearchInfo>
        <SearchInfoTitle>
          热门搜索
          <SearchInfoSwitch>换一批</SearchInfoSwitch>
        </SearchInfoTitle>
        <SearchInfoList>
          <SearchInfoItem>教育</SearchInfoItem>
          <SearchInfoItem>教育</SearchInfoItem>
          <SearchInfoItem>教育</SearchInfoItem>
          <SearchInfoItem>教育</SearchInfoItem>
          <SearchInfoItem>教育</SearchInfoItem>
          <SearchInfoItem>教育</SearchInfoItem>
          <SearchInfoItem>教育</SearchInfoItem>
        </SearchInfoList>
      </SearchInfo>
    )
  } else {
    return null
  }
}
```

在`<SearchWrapper>`标签结束位置前加入热门搜索框函数`{getListArea(props.focused)}`

![image-20210123194035307](E:\前端自学\笔记\简书项目笔记\imgs\image-20210123194035307.png)

### 6.Ajax获取推荐数据

现将src\common\header\index.js中的`Header`改为普通组件

```JavaScript
class Header extends Component {
  getListArea(show) {
    if (show) {
      return (
        <SearchInfo>
          <SearchInfoTitle>
            热门搜索
            <SearchInfoSwitch>换一批</SearchInfoSwitch>
          </SearchInfoTitle>
          <SearchInfoList>
            <SearchInfoItem>教育</SearchInfoItem>
            <SearchInfoItem>教育</SearchInfoItem>
            <SearchInfoItem>教育</SearchInfoItem>
            <SearchInfoItem>教育</SearchInfoItem>
            <SearchInfoItem>教育</SearchInfoItem>
            <SearchInfoItem>教育</SearchInfoItem>
            <SearchInfoItem>教育</SearchInfoItem>
          </SearchInfoList>
        </SearchInfo>
      )
    } else {
      return null
    }
  }
  render() {
    return (
      <HeaderWarpper>
        <Logo />
        <Nav>
          <NavItem className="left active">首页</NavItem>
          <NavItem className="left">下载App</NavItem>
          <NavItem className="right">登录</NavItem>
          <NavItem className="right">
            <span className="iconfont">&#xe636;</span>
          </NavItem>
          <SearchWrapper>
            <CSSTransition
              in={this.props.focused}
              timeout={200}
              classNames="slide"
            >
              <NavSearch
                className={this.props.focused ? 'focused' : ''}
                onFocus={this.props.handleInputFocus}
                onBlur={this.props.handleInputBlur}
              ></NavSearch>
            </CSSTransition>
            <span
              className={this.props.focused ? 'focused iconfont' : 'iconfont'}
            >
              &#xe614;
            </span>
            {this.getListArea(this.props.focused)}
          </SearchWrapper>
        </Nav>
        <Addition>
          <Button className="writting">
            <span className="iconfont">&#xe708;</span>
            写文章
          </Button>
          <Button className="reg">注册</Button>
        </Addition>
      </HeaderWarpper>
    )
  }
}
```

在src\common\header\store\reducer.js中给`defaultState`加个`list:[]`空数组

```JavaScript
const defaultState = fromJS({
  focused: false,
  list: [],
})
```



#### 1)安装`redux-thunk`

```javascript
npm install --save redux-thunk
```

在src\store\index.js中配置thunk中间件

调用`redux-thunk`并且使用`applyMiddleware`方法加入thunk中间件实现异步操作

```JavaScript
import { createStore, compose, applyMiddleware } from 'redux'
import thunk from 'redux-thunk'
import reducer from './reducer'

const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose

const store = createStore(reducer, composeEnhancers(applyMiddleware(thunk)))

export default store
```

#### 2）安装`axios`第三方模块

```JavaScript
npm install axios
```

在src\common\header\store\actionCreators.js中调用`axios`

```JavaScript
import axios from 'axios'
```

在src\common\header\index.js中给`  handleInputFocus() `函数增加`gteList`派遣

```JavaScript
const mapDispathToProps = (dispath) => {
  return {
    handleInputFocus() {
      dispath(actionCreators.getList())
      dispath(actionCreators.searchFocus())
    },
    handleInputBlur() {
      dispath(actionCreators.searchBlur())
    },
  }
}
```

在src\common\header\store\actionCreators.js中定义一个`getList`函数对象，`axios`的使用`get`、`then`、`catch`方法模拟API调用

```JavaScript
export const getList = () => {
  return (dispatch) => {
    axios
      .get('/api/headerList.json')
      .then((res) => {})
      .catch(() => {
        console.log('error')
      })
  }
}
```

#### 3）模拟后端数据并优化代码

在public文件夹下建立一个api文件夹，api文件夹建立一个haederList.json文件

![image-20210123155559937](C:\Users\jackhoo\AppData\Roaming\Typora\typora-user-images\image-20210123155559937.png)

模拟后端数据，在项目上线之前删除

在public\api\headerList.json文件中，与后端沟通统一接口和一定的格式，添加数据

```javascript
{
    "success":true,
    "data":["高考","区块链","教育","1123小程序","施工队zzcz","撒GV撒而过","1生1世","高1313考","12345","教12育","小程序","施工1队zzcz","撒GV撒3而过","三生三世"]
}
```

在src\common\header\store\actionCreators.js中

导入`immutable`中的`fromJS`方法，并派遣data数据

```JavaScript
import * as actionTypes from './actionTypes'
import axios from 'axios'
import { fromJS } from 'immutable'

export const searchFocus = () => ({
  type: actionTypes.SEARCH_FOCUS,
})
export const searchBlur = () => ({
  type: actionTypes.SEARCH_BLUR,
})

export const getList = () => {
  return (dispatch) => {
    axios
      .get('/api/headerList.json')
      .then((res) => {
        const data = res.data
        dispatch(changeList(data.data))
      })
      .catch(() => {
        console.log('error')
      })
  }
}

const changeList = (data) => ({
  type: actionTypes.CHANGE_LIST,
  data: fromJS(data), //defaultState中的list数组是immutable数组，原来data是普通数组，传到会出错defaultState中的list，将它转换成immutable数组
})

```

在src\common\header\index.js中，热门推荐`<SearchInfoList>`标签修改`<SearchInfoItem>`标签内数据获取方法，这里`list.map`是`immutable`的方法

```javascript
<SearchInfoList>
	{list.map((item) => {
	return <SearchInfoItem key={item}>{item}</SearchInfoItem>
	})}
</SearchInfoList>
```

`mapStateToProps`函数中得到`list`中的数据

```javascript
const mapStateToProps = (state) => {
  return {
    focused: state.getIn(['header', 'focused']),
    list: state.getIn(['header', 'list']),
  }
}
```

在src\common\header\store\reducer.js中设置返回`list'`数据并优化代码

```JavaScript
export default (state = defaultState, action) => {
  switch (action.type) {
    case actionTypes.SEARCH_FOCUS:
      //immutable对象的set方法，会结合之前的immutable对象的值和设置的值，返回一个全新的对象
      return state.set('focused', true)
    case actionTypes.SEARCH_BLUR:
      return state.set('focused', false)
    case actionTypes.CHANGE_LIST:
      return state.set('list', action.data)
    default:
      return state
  }
}
```

在src\common\header\index.js中优化代

在`Header`中用`{ focused, list }、{ focused, handleInputFocus, handleInputBlur }`代替`this.props`

```JavaScript
class Header extends Component {
  getListArea() {
    const { focused, list } = this.props
    if (focused) {
      return (
        <SearchInfo>
          <SearchInfoTitle>
            热门搜索
            <SearchInfoSwitch>换一批</SearchInfoSwitch>
          </SearchInfoTitle>
          <SearchInfoList>
            {list.map((item) => {
              return <SearchInfoItem key={item}>{item}</SearchInfoItem>
            })}
          </SearchInfoList>
        </SearchInfo>
      )
    } else {
      return null
    }
  }
  render() {
    const { focused, handleInputFocus, handleInputBlur } = this.props
    return (
      <HeaderWarpper>
        <Logo />
        <Nav>
          <NavItem className="left active">首页</NavItem>
          <NavItem className="left">下载App</NavItem>
          <NavItem className="right">登录</NavItem>
          <NavItem className="right">
            <span className="iconfont">&#xe636;</span>
          </NavItem>
          <SearchWrapper>
            <CSSTransition in={focused} timeout={2000} classNames="slide">
              <NavSearch
                className={focused ? 'focused' : ''}
                onFocus={handleInputFocus}
                onBlur={handleInputBlur}
              ></NavSearch>
            </CSSTransition>
            <span className={focused ? 'focused iconfont' : 'iconfont'}>
              &#xe614;
            </span>
            {this.getListArea()}
          </SearchWrapper>
        </Nav>
        <Addition>
          <Button className="writting">
            <span className="iconfont">&#xe708;</span>
            写文章
          </Button>
          <Button className="reg">注册</Button>
        </Addition>
      </HeaderWarpper>
    )
  }
}
```

### 7.热门搜索切换页面功能

#### 1）替换iconfont重要文件

在iconfont图库中找一个旋转的图标，保存在上一个项目里，重新下载，

注意重要文件中原来iconfont.js不要替换，在新的iconfont.css中打开把代码复制到原来iconfont.js中。url地址的./还是要加。

在src\common\header\index.js中在换一换前加入新的旋转图标

![image-20210124132722270](E:\前端自学\笔记\简书项目笔记\imgs\image-20210124132722270.png)

在原来的搜索图标中加入属性zoom

![image-20210124132841315](E:\前端自学\笔记\简书项目笔记\imgs\image-20210124132841315.png)

在src\common\header\style.js中`SearchWrapper`样式iconf属性改成zoom

![image-20210124133138969](E:\前端自学\笔记\简书项目笔记\imgs\image-20210124133138969.png)

在`SearchInfoSwitch`样式中加入旋转样式

![image-20210124133326339](E:\前端自学\笔记\简书项目笔记\imgs\image-20210124133326339.png)

#### 2）给旋转添加动画`transform`方法

在src\common\header\style.js文件中`SearchInfoSwitch`样式给旋转属性添加`transition`值

```javascript
export const SearchInfoSwitch = styled.span`
  float: right;
  font-size: 13px;
  .spin {
    display: block;
    float: left;
    font-size: 10px;
    margin-right: 2px;
    transition: all 0.2s ease-in;
    transform-origin: center center;
  }
`
```

然后在src\common\header\index.js中`ref`获取旋转`spinIcon`节点和点击绑定

```JavaScript
            <SearchInfoSwitch
              onClick={() => handleChangePage(page, totalPage, this.spinIcon)}
            >
              <span //ref可以获取到dom真实的节点
                ref={(icon) => {
                  this.spinIcon = icon
                }}
                className="iconfont spin"
              >
                &#xe61d;
              </span>
              换一批
            </SearchInfoSwitch>
```

在`handleChangePage`函数中改变旋转角度

```JavaScript
    handleChangePage(page, totalPage, spin) {
      let originAngle = spin.style.transform.replace(/[^0-9]/gi, '')
      if (originAngle) {
        originAngle = parseInt(originAngle, 10)
      } else {
        originAngle = 0
      }
      spin.style.transform = 'rotate(' + (originAngle + 360) + 'deg)'

      if (page < totalPage) {
        dispath(actionCreators.changePage(page + 1))
      } else {
        dispath(actionCreators.changePage(1))
      }
    },
```

### 8.提升性能，避免无意义ajax请求

在src\common\header\index.js中`onFocus`加一个箭头函数传一个`list`

```JavaScript
              <NavSearch
                className={focused ? 'focused' : ''}
                onFocus={() => handleInputFocus(list)}
                onBlur={handleInputBlur}
              ></NavSearch>
```

然后在`handleInputFocus`函数中接收到`list`并判断`list.size`为空时才开始派遣，只执行一次`getlist`，`ajax`请求

```JavaScript
    handleInputFocus(list) {
      list.size === 0 && dispath(actionCreators.getList())
      dispath(actionCreators.searchFocus())
    },
```





### 9.路由功能

#### 1）React Router 安装命令如下

```JavaScript
npm install --save react-router-dom
```

在src\App.js中引入路由

```JavaScript
import { BrowserRouter, Route } from 'react-router-dom'
```

`BrowserRouter`是路由

`Route`是路由规则

#### 2）首页组件拆分，首页布局

在src文件夹下新建下一个pages文件夹以及文件

![image-20210128174615614](E:\前端自学\笔记\简书项目笔记\imgs\image-20210128174615614.png)

在src\pages\home\index.js文件下

```JavaScript
import React, { Component } from 'react'
import Topic from './componen/Topic'
import Writer from './componen/Writer'
import List from './componen/List'
import Recommend from './componen/Recommend'

import { HomeWrapper, HomeLeft, HomeRight } from './style'

class Home extends Component {
  render() {
    return (
      <HomeWrapper>
        <HomeLeft>
          <img
            alt=""
            className="banner-img"
  src="//upload.jianshu.io/admin_banners/web_images/4318/60781ff21df1d1b03f5f8459e4a1983c009175a5.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/1250/h/540"
          />
          <Topic />
          <List />
        </HomeLeft>
        <HomeRight>
          <Recommend />
          <Writer />
        </HomeRight>
      </HomeWrapper>
    )
  }
}
export default Home
```

在src\pages\home\style.js文件下

```JavaScript
import styled from 'styled-components'

export const HomeWrapper = styled.div`
  overflow: hidden;
  width: 960px;
  margin: 0 auto;
`
export const HomeLeft = styled.div`
  margin-left: 15px;
  padding-top: 30px;
  width: 625px;
  float: left;
  .banner-img {
    width: 625px;
    heigtht: 240px;
  }
`
export const HomeRight = styled.div`
  width: 280px;
  float: right;
`
export const TopicWrapper = styled.div`
  padding: 20px 0 10px 0;
  overflow: hidden;
  //   margin-left: -10px;
  border-bottom: 1px solid #dcdcdc;
`
export const TopicItem = styled.div`
  float: left;
  height: 32px;
  line-height: 32px;
  margin-right: 10px;
  margin-bottom: 10px;
  padding-right: 10px;
  background: #f7f7f7;
  font-size: 14px;
  color: #000;
  border: 1px solid #dcdcdc;
  border-radius: 4px;
  .topic-pic {
    display: block;
    float: left;
    width: 32px;
    height: 32px;
    margin-right: 10px;
  }
`
```

在src\pages\home\componen\List.js文件下，其他文件也是类似

```JavaScript
import React, { Component } from 'react'

class List extends Component {
  render() {
    return <div>List</div>
  }
}

export default List

```

在src\pages\home\componen\Topic.js中

```JavaScript
import React, { Component } from 'react'
import { connect } from 'react-redux'
import { TopicWrapper, TopicItem } from '../style'

class Topic extends Component {
  render() {
    const { list } = this.props
    return (
      <TopicWrapper>
        {list.map((item) => (
          <TopicItem key={item.get('id')}>
            <img className="topic-pic" src={item.get('imgUrl')} alt="" />
            {item.get('title')}
          </TopicItem>
        ))}
      </TopicWrapper>
    )
  }
}
const mapState = (state) => ({
  list: state.getIn(['home', 'topicList']),
})
export default connect(mapState, null)(Topic)
```

在src\pages\home\store\index.js入口文件中

```JavaScript
import reducer from './reducer'

export { reducer }

```

然后在src\store\reducer.js文件中调用、添加`homeReducer`组件

```JavaScript
import { combineReducers } from 'redux-immutable'
import { reducer as headerReducer } from '../common/header/store'
import { reducer as homeReducer } from '../pages/home/store'

const reducer = combineReducers({
  header: headerReducer,
  home: homeReducer,
})
export default reducer

```

在src\pages\home\store\reducer.js中

```JavaScript
import { fromJS } from 'immutable'

const defaultState = fromJS({
  topicList: [
    {
      id: 1,
      title: '社会热点',
      imgUrl: '##',
    },
    {
      id: 2,
      title: '手绘',
      imgUrl: '#',
    },
  ],
})
export default (state = defaultState, action) => {
  switch (action.type) {
    default:
      return state
  }
}
```

#### 3）首页文字列表

在src\pages\home\componen\List.js中

```JavaScript
import React, { Component } from 'react'
import { ListItem, ListInfo } from '../style'
import { connect } from 'react-redux'

class List extends Component {
  render() {
    const { list } = this.props
    return (
      <div>
        {list.map((item) => {
          return (
            <ListItem key={item.get('id')}>
              <img className="pic" sec={item.get('imgUrl')} alt="" />
              <ListInfo>
                <h3 className="title">{item.get('title')}</h3>
                <p className="desc">{item.get('desc')}</p>
              </ListInfo>
            </ListItem>
          )
        })}
      </div>
    )
  }
}
const mapState = (state) => ({
  list: state.getIn(['home', 'articleList']),
})

export default connect(mapState)(List)

```

在src\pages\home\store\reducer.js中加入`articleList`

```JavaScript
import { fromJS } from 'immutable'

const defaultState = fromJS({
  topicList: [
    {
      id: 1,
      title: '社会热点',
      imgUrl: '##',
    },
    {
      id: 2,
      title: '手绘',
      imgUrl: '#',
    },
  ],
  articleList: [
    {
      id: 1,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
    {
      id: 2,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
    {
      id: 3,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
    {
      id: 4,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
  ],
})

export default (state = defaultState, action) => {
  switch (action.type) {
    default:
      return state
  }
}
```

在src\pages\home\style.js加入`ListItem`的样式

```JavaScript
export const ListItem = styled.div`
  overflow: hidden;
  padding: 20px 0;
  border-bttom: 1px solid #dcdcdc;
  .pic {
    display: block;
    width: 125px;
    height: 100px;
    float: right;
    border-radius: 10px;
  }
`
export const ListInfo = styled.div`
  width: 500px;
  float: left;
  .title {
    line-height: 27px;
    font-size: 18px;
    font-weight: bold;
    color: #333;
  }
  .desc {
    line-height: 24px;
    font-size: 13px;
    color: #999;
  }
`
```

#### 4）首页推荐部分

在src\pages\home\componen\Recommend.js中

```JavaScript
import React, { Component } from 'react'
import { connect } from 'react-redux'

import { RecommendWrapper, RecommendItem } from '../style'

class Recommend extends Component {
  render() {
    return (
      <RecommendWrapper>
        {this.props.list.map((item) => {
          return (
            <RecommendItem imgUrl={item.get('imgUrl')} key={item.get('id')} />
          )
        })}
      </RecommendWrapper>
    )
  }
}

const mapState = (state) => ({
  list: state.getIn(['home', 'recommendList']),
})
export default connect(mapState, null)(Recommend)

```

在src\pages\home\style.js中添加组件样式

```JavaScript
export const RecommendWrapper = styled.div`
  margin: 30px 0;
  width: 280px;
`
export const RecommendItem = styled.div`
  width: 280px;
  height: 50px;
  background: url(${(props) => props.imgUrl});
  background-size: contain;
  border: 1px solid #dcdcdc;
`
export const WriterWrapper = styled.div`
  width:278px;
  border1px solid #dcdcdc;
  border-radius:3px;
  height:300px;
  line-height:300px;
  text-align:center;
`
```

在src\pages\home\store\reducer.js中

```JavaScript
import { fromJS } from 'immutable'

const defaultState = fromJS({
  topicList: [
    {
      id: 1,
      title: '社会热点',
      imgUrl: '##',
    },
    {
      id: 2,
      title: '手绘',
      imgUrl: '#',
    },
  ],
  articleList: [
    {
      id: 1,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
    {
      id: 2,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
    {
      id: 3,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
    {
      id: 4,
      title: '1111111111111111',
      desc: '22222222222222222222',
      imgUrl: '#',
    },
  ],
  recommendList: [
    {
      id: 1,
      imgUrl: '#1',
    },
    {
      id: 2,
      imgUrl: '#2',
    },
  ],
})
export default (state = defaultState, action) => {
  switch (action.type) {
    default:
      return state
  }
}
```

#### 5）首页异步数据获取

在public\api\下新建一个文件夹home.json，设置返回值`success`和`data`数据

```JavaScript
{
	"success": true,
	"data": {
		"topicList": [{
			"id": 1,
			"title": "社会热点",
			"imgUrl": "//upload.jianshu.io/collections/images/261938/man-hands-reading-boy-large.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}, {
			"id": 2,
			"title": "手手绘",
			"imgUrl": "//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}],
		"articleList": [{
			"id": 1,
			"title": "胡歌12年后首谈车祸",
			"desc": "文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：...",
			"imgUrl": "//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}, {
			"id": 2,
			"title": "胡歌12年后首谈车祸：既然活下来了，就不能白白活着",
			"desc": "文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：...",
			"imgUrl": "//upload.jianshu.io/collections/images/261938/man-hands-reading-boy-large.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}, {
			"id": 3,
			"title": "胡歌12年后首谈车祸：既然活下来了，就不能白白活着",
			"desc": "文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：...",
			"imgUrl": "//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}, {
			"id": 4,
			"title": "胡歌12年后首谈车祸：既然活下来了，就不能白白活着",
			"desc": "文/麦大人 01 胡歌又刷屏了。 近日他上了《朗读者》，而这一期的主题是“生命”，他用磁性的嗓音，朗读了一段《哈姆雷特》中的经典独白，相当震撼：...",
			"imgUrl": "//upload-images.jianshu.io/upload_images/2259045-2986b9be86b01f63?imageMogr2/auto-orient/strip|imageView2/1/w/300/h/240"
		}],
		"recommendList": [{
			"id": 1,
			"imgUrl": "//upload.jianshu.io/collections/images/261938/man-hands-reading-boy-large.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}, {
			"id": 2,
			"imgUrl": "//upload.jianshu.io/collections/images/21/20120316041115481.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/64/h/64"
		}]
	}
}
```

在src\pages\home\store\reducer.js将文件信息移动到`home.json`中，

```JavaScript
import { fromJS } from 'immutable'

const defaultState = fromJS({
  topicList: [],
  articleList: [],
  recommendList: [],
})

export default (state = defaultState, action) => {
  switch (action.type) {
    case 'change_home_data':
      return state.merge({
        topicList: fromJS(action.topicList),
        articleList: fromJS(action.articleList),
        recommendList: fromJS(action.recommendList),
      })
    default:
      return state
  }
}

```

在src\pages\home\index.js中绑定home组件

```JavaScript
import React, { Component } from 'react'
import { connect } from 'react-redux'
import Topic from './componen/Topic'
import Writer from './componen/Writer'
import List from './componen/List'
import Recommend from './componen/Recommend'
import axios from 'axios'

import { HomeWrapper, HomeLeft, HomeRight } from './style'

class Home extends Component {
  render() {
    return (
      <HomeWrapper>
        <HomeLeft>
          <img
            alt=""
            className="banner-img"
            src="//upload.jianshu.io/admin_banners/web_images/4318/60781ff21df1d1b03f5f8459e4a1983c009175a5.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/1250/h/540"
          />
          <Topic />
          <List />
        </HomeLeft>
        <HomeRight>
          <Recommend />
          <Writer />
        </HomeRight>
      </HomeWrapper>
    )
  }
  componentDidMount() {
    axios.get('/api/home.json').then((res) => {
      const result = res.data.data
      const action = {
        type: 'change_home_data',
        topicList: result.topicList,
        articleList: result.articleList,
        recommendList: result.recommendList,
      }
      this.props.changeHomeData(action)
    })
  }
}
const mapDispatch = (dispatch) => ({
  changeHomeData(action) {
    dispatch(action)
  },
})

export default connect(null, mapDispatch)(Home)

```

#### 6）代码拆分优化

在src\pages\home\store\中新建文件actionTypes.js

```JavaScript
export const CHANGE_HOME_DATA = 'home/CHANGE_HOME_DATA'

```

在src\pages\home\store\中新建actionCreators.js

```JavaScript
import axios from 'axios'
import * as actionTypes from './actionTypes'

const changeHomeData = (result) => ({
  type: actionTypes.CHANGE_HOME_DATA,
  topicList: result.topicList,
  articleList: result.articleList,
  recommendList: result.recommendList,
})

export const getHomeInfo = () => {
  return (dispatch) => {
    axios.get('/api/home.json').then((res) => {
      const result = res.data.data
      dispatch(changeHomeData(result))
    })
  }
}

```

在src\pages\home\store\index.js中导入actionTypes组件

```JavaScript
import reducer from './reducer'
import * as actionCreators from './actionCreators'
import * as actionTypes from './actionTypes'

export { reducer, actionCreators, actionTypes }

```

在src\pages\home\store\reducer.js

```JavaScript
import { fromJS } from 'immutable'
import * as actionTypes from './actionTypes'

const defaultState = fromJS({
  topicList: [],
  articleList: [],
  recommendList: [],
})

export default (state = defaultState, action) => {
  switch (action.type) {
    case actionTypes.CHANGE_HOME_DATA:
      return state.merge({
        topicList: fromJS(action.topicList),
        articleList: fromJS(action.articleList),
        recommendList: fromJS(action.recommendList),
      })
    default:
      return state
  }
}

```

在src\pages\home\index.js

```JavaScript
import React, { Component } from 'react'
import { connect } from 'react-redux'
import Topic from './componen/Topic'
import Writer from './componen/Writer'
import List from './componen/List'
import Recommend from './componen/Recommend'
import { HomeWrapper, HomeLeft, HomeRight } from './style'
import { actionCreators } from './store'

class Home extends Component {
  render() {
    return (
      <HomeWrapper>
        <HomeLeft>
          <img
            alt=""
            className="banner-img"
            src="//upload.jianshu.io/admin_banners/web_images/4318/60781ff21df1d1b03f5f8459e4a1983c009175a5.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/1250/h/540"
          />
          <Topic />
          <List />
        </HomeLeft>
        <HomeRight>
          <Recommend />
          <Writer />
        </HomeRight>
      </HomeWrapper>
    )
  }
  componentDidMount() {
    this.props.changeHomeData()
  }
}
const mapDispatch = (dispatch) => ({
  changeHomeData() {
    const action = actionCreators.getHomeInfo()
    dispatch(action)
  },
})

export default connect(null, mapDispatch)(Home)

```

#### 7）实现加载更多功能

在src\pages\home\componen\List.js中加入`page`

```JavaScript
import React, { Component } from 'react'
import { ListItem, ListInfo, LoadMore } from '../style'
import { connect } from 'react-redux'
import { actionCreators } from '../store'

class List extends Component {
  render() {
    const { list, getMoreList, page } = this.props
    return (
      <div>
        {list.map((item, index) => {
          return (
            <ListItem key={index}>
              <img className="pic" sec={item.get('imgUrl')} alt="" />
              <ListInfo>
                <h3 className="title">{item.get('title')}</h3>
                <p className="desc">{item.get('desc')}</p>
              </ListInfo>
            </ListItem>
          )
        })}
        <LoadMore onClick={() => getMoreList(page)}>阅读更多</LoadMore>
      </div>
    )
  }
}
const mapState = (state) => ({
  list: state.getIn(['home', 'articleList']),
  page: state.getIn(['home', 'articlePage']),
})

const mapDispatch = (dispatch) => ({
  getMoreList(page) {
    dispatch(actionCreators.getMoreList(page))
  },
})

export default connect(mapState, mapDispatch)(List)

```

在src\pages\home\style.js中添加更多的样式

```JavaScript
export const LoadMore = styled.div`
  width: 100%;
  height: 40px;
  line-height: 40px;
  margin 30px 0;
  background: #a5a5a5;
  text-align: center;
  border-radius: 20px;
  color: #fff;
  cursor:pointer;
`
```



在src\pages\home\store\actionCreators.js中添加加页的逻辑操作

```JavaScript
import axios from 'axios'
import * as actionTypes from './actionTypes'
import { fromJS } from 'immutable'

const changeHomeData = (result) => ({
  type: actionTypes.CHANGE_HOME_DATA,
  topicList: result.topicList,
  articleList: result.articleList,
  recommendList: result.recommendList,
})

const addHomeList = (list, nextPage) => ({
  type: actionTypes.ADD_ARTICLE_LIST,
  list: fromJS(list),
  nextPage,
})

export const getHomeInfo = () => {
  return (dispatch) => {
    axios.get('/api/home.json').then((res) => {
      const result = res.data.data
      dispatch(changeHomeData(result))
    })
  }
}

export const getMoreList = (page) => {
  return (dispatch) => {
    axios.get('/api/homeList.json?page=' + page).then((res) => {
      const result = res.data.data
      dispatch(addHomeList(result, page + 1))
    })
  }
}

```

在src\pages\home\store\reducer.js中添加`articlePage`页码

```JavaScript
const defaultState = fromJS({
  topicList: [],
  articleList: [],
  recommendList: [],
  articlePage: 1,
})
```

然后点击之后加载下一页

```JavaScript
    case actionTypes.ADD_ARTICLE_LIST:
      return state.merge({
        articleList: state.get('articleList').concat(action.list),
        articlePage: action.nextPage,
      })
```

#### 8）回到顶部组件

在src\pages\home\index.js中添加`BackTop`组件，添加回到顶部点击事件，鼠标滑动超过100时触发事件，并挂载在网页后取消挂载

```JavaScript
import React, { Component } from 'react'
import { connect } from 'react-redux'
import Topic from './componen/Topic'
import Writer from './componen/Writer'
import List from './componen/List'
import Recommend from './componen/Recommend'
import { HomeWrapper, HomeLeft, HomeRight } from './style'
import { actionCreators } from './store'
import { BackTop } from './style'

class Home extends Component {
  handleScrollTop() {
    window.scrollTo(0, 0)
  }
  render() {
    return (
      <HomeWrapper>
        <HomeLeft>
          <img
            alt=""
            className="banner-img"
   src="//upload.jianshu.io/admin_banners/web_images/4318/60781ff21df1d1b03f5f8459e4a1983c009175a5.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/1250/h/540"
          />
          <Topic />
          <List />
        </HomeLeft>
        <HomeRight>
          <Recommend />
          <Writer />
        </HomeRight>
        {this.props.showScroll ? (
          <BackTop onClick={this.handleScrollTop}>顶部</BackTop>
        ) : null}
      </HomeWrapper>
    )
  }
  componentDidMount() {
    this.props.changeHomeData()
    this.binEvents()
  }
  componentWillUnmount() {
    window.addEventListener('scroll', this.props.changeScrollTopShow)
  }
  binEvents() {
    window.addEventListener('scroll', this.props.changeScrollTopShow)
  }
}

const mapState = (state) => ({
  showScroll: state.getIn(['home', 'showScroll']),
})
const mapDispatch = (dispatch) => ({
  changeHomeData() {
    dispatch(actionCreators.getHomeInfo())
  },
  changeScrollTopShow() {
    if (document.documentElement.scrollTop > 100) {
      dispatch(actionCreators.toggleTopShow(true))
    } else {
      dispatch(actionCreators.toggleTopShow(false))
    }
  },
})

export default connect(mapState, mapDispatch)(Home)

```

在src\pages\home\style.js中添加回到顶部样式

```JavaScript
export const BackTop = styled.div`
  position: fixed;
  right: 100px;
  bottom: 100px;
  width: 60px;
  height: 30xp;
  line-height: 30px;
  text-align: center;
  border: 1px solid #ccc;
  font-size: 14px;
`
```

在src\pages\home\store\actionTypes.js

```JavaScript
export const TOGGLE_SCROLL_TOP = 'home/TOGGLE_SCROLL_TOP'

```

在src\pages\home\store\actionCreators.js中

```JavaScript
export const toggleTopShow = (show) => ({
  type: actionTypes.TOGGLE_SCROLL_TOP,
  show,
})

```

在src\pages\home\store\reducer.js中添加回到顶部隐藏启动功能并优化代码

```JavaScript
import { fromJS } from 'immutable'
import * as actionTypes from './actionTypes'

const defaultState = fromJS({
  topicList: [],
  articleList: [],
  recommendList: [],
  articlePage: 1,
  showScroll: false,
})

const changeHomeData = (state, action) => {
  return state.merge({
    topicList: fromJS(action.topicList),
    articleList: fromJS(action.articleList),
    recommendList: fromJS(action.recommendList),
  })
}
const addArticleList = (state, action) => {
  return state.merge({
    articleList: state.get('articleList').concat(action.list),
    articlePage: action.nextPage,
  })
}

export default (state = defaultState, action) => {
  switch (action.type) {
    case actionTypes.CHANGE_HOME_DATA:
      return changeHomeData(state, action)
    case actionTypes.ADD_ARTICLE_LIST:
      return addArticleList(state, action)
    case actionTypes.TOGGLE_SCROLL_TOP:
      return state.set('showScroll', action.show)
    default:
      return state
  }
}

```

#### 9）性能优化以及路由跳转

用了`immutable`然后再使用`PureComponent`替换所有`Component`会提升性能，减少渲染

**Component和PureComponent有一个不同点**

除了为你提供了一个具有浅比较的`shouldComponentUpdate`方法，`PureComponent`和`Component`基本上完全相同。当`props`或者`state`改变时，`PureComponent`将对`props`和`state`进行浅比较。另一方面，Component不会比较当前和下个状态的`props`和`state`。因此，每当`shouldComponentUpdate`被调用时，组件默认的会重新渲染。

**浅比较101**

当把之前和下一个的`props`和`state`作比较，浅比较将检查原始值是否有相同的值（例如：`1 == 1`或者`ture==true`）,数组和对象引用是否相同。

**从不改变**

您可能已经听说过，不要在`props`和`state`中改变对象和数组，如果你在你的父组件中改变对象，你的“pure”子组件不将更新。虽然值已经被改变，但是子组件比较的是之前`props`的引用是否相同，所以不会检测到不同。

因此，你可以通过使用es6的assign方法或者数组的扩展运算符或者使用第三方库，强制返回一个新的对象。



**性能优化**

在src\pages\home\componen文件夹中的文件

对所有`Component`替换成`PureComponent`

**路由跳转**

在src\common\header\index.js中加入`Link`组件

```JavaScript
import { Link } from 'react-router-dom'

```

在`<Logo >`标签前后加入`<Link>`标签

```javascript
        <Link to="/">
          <Logo />
        </Link>
```

在src\common\header\style.js中将Logo的a标签属性改成div

```JavaScript
export const Logo = styled.div.attrs({
  href: '/', //a标签的属性，跳转到首页
})`
```

在src\App.js中将`<Header />`标签包裹在`     <BrowserRouter>`标签内

```JavaScript

class App extends Component {
  render() {
    return (
      <Provider store={store}>
        <div>
          <IconfontStyle />
          <GlobalStyle />
          <BrowserRouter>
            <div>
              <Header />
              <Route path="/" exact component={Home}></Route>
              <Route path="/detail" exact component={Detail}></Route>
            </div>
          </BrowserRouter>
        </div>
      </Provider>
    )
  }
}
export default App
```

在src\pages\home\componen\List.js中加入`Link`组件

```javascript
import { Link } from 'react-router-dom'

```

在`List`组件中将a标签换成Link标签

```JavaScript
class List extends PureComponent {
  render() {
    const { list, getMoreList, page } = this.props
    return (
      <div>
        {list.map((item, index) => {
          return (
            <Link key={index} to="/detail">
              <ListItem>
                <img className="pic" sec={item.get('imgUrl')} alt="" />
                <ListInfo>
                  <h3 className="title">{item.get('title')}</h3>
                  <p className="desc">{item.get('desc')}</p>
                </ListInfo>
              </ListItem>
            </Link>
          )
        })}
        <LoadMore onClick={() => getMoreList(page)}>阅读更多</LoadMore>
      </div>
    )
  }
}
```

### 10.详情页面以及登录功能

#### 1)详情页面布局

在src\pages\detail下创建store

![image-20210201135454092](E:\前端自学\笔记\简书项目笔记\imgs\image-20210201135454092.png)



在src\pages\detail\index.js

```JavaScript
import React, { Component } from 'react'
import { DetailWrapper, Header, Content } from './style'

class Detail extends Component {
  render() {
    return (
      <DetailWrapper>
        <Header></Header>
        <Content></Content>
      </DetailWrapper>
    )
  }
}

export default Detail

```

在src\pages\detail\style.js

```JavaScript
import styled from 'styled-components'

export const DetailWrapper = styled.div`
  overflow: hidden;
  width: 620px;
  margin: 0 auto;
  padding-bottom: 100px;
`
export const Header = styled.div`
  margin: 50px 0 20px 0;
  line-height: 44px;
  font-size: 34px;
  color: #333;
  font-weight: bold;
`
export const Content = styled.div`
  color: #2f2f2f;
  img {
    width: 100%;
  }
  p {
    margin: 25px 0;
    font-size: 16px;
    line-height: 30px;
  }
  b {
    font-weight: bold;
  }
`

```

在src\pages\detail\store\index.js中

```JavaScript
import reducer from './reducer'
import * as actionCreators from './actionCreators'
import * as actionTypes from './actionTypes'

export { reducer, actionCreators, actionTypes }

```

到这里由于代码管理不慎回到了几天前的状态，现在最后一章代码日志不更新，只更新一些知识点



### 动态路由

在src\pages\home\components\List.js中 to加上得到id

```JavaScript
	<Link key={index} to={'/detail/' + item.get('id')}>
```

在src\App.js中，`path="/detail/:id"`加上/:id就能实现路径匹配

```JavaScript
    <Route path="/detail/:id" exact component={Detail}></Route>
```

在src\pages\detail\index.js中通过`this.props.match.params.id`挂载获取到id

```JavaScript
class Detail extends PureComponent {
  render() {
    return (
      <DetailWrapper>
        <Header>{this.props.title}</Header>
        <Content dangerouslySetInnerHTML={{ __html: this.props.content }} />
      </DetailWrapper>
    )
  }

  componentDidMount() {
    this.props.getDetail(this.props.match.params.id)
  }
}
```

然后将id派遣到store就能实现动态路由

```JavaScript
const mapDispatch = (dispatch) => ({
  getDetail(id) {
    dispatch(actionCreators.getDetail(id))
  },
})

```



### innerRef中的BUG

在src\pages\login\index.js中使用innerRef时会报错，`console.log(accountElem, passwordElem)`会显示undefined

```JavaScript
            {/* <Input
              placeholder="账号"
              innerRef={(input) => {
                this.account = input
              }}
            />
            <Input
              placeholder="密码"
              type="password"
              innerRef={(input) => {
                this.password = input
              }}
            /> */}
            <Input
              placeholder="账号"
              ref={(input) => {
                this.account = input
              }}
            />
            <Input
              placeholder="密码"
              type="password"
              ref={(input) => {
                this.password = input
              }}
            />
```

在使用ref后就会显示正常，`console.log(accountElem.value, passwordElem.value)`能够获取账号密码

```JavaScript
const mapDispatch = (dispatch) => ({
  login(accountElem, passwordElem) {
    // console.log(accountElem.value, passwordElem.value)
    dispatch(actionCreators.login(accountElem.value, passwordElem.value))
  },
})
```





### 登录时请求数据

在src\pages\login\store\actionCreators.js中，进行数据请求，模拟请求暂时用get，应该用post。

`login = (accout, password)`接收两个参数，与后端验证是否登录成功，与后端统一路径

```JavaScript
import axios from 'axios';
import * as constants from './constants';

const changeLogin = () => ({
	type: constants.CHANGE_LOGIN,
	value: true
})

export const logout = () => ({
	type: constants.LOGOUT,
	value: false
})

export const login = (accout, password) => {
	return (dispatch) => {
		axios.get('/api/login.json?account=' + accout + '&password=' + password).then((res) => {
			const result = res.data.data;
			if (result) {
				dispatch(changeLogin())
			}else {
				alert('登陆失败')
			}
		})
	}
}
```



### 重定向

在src\pages\login\index.js中导入`Redirect`组件

```JavaScript
import { Redirect } from 'react-router-dom'

```

然后判断登录之后重定向到首页

```JavaScript
    if (!loginStatus) {
        
    }else {
      return <Redirect to="/" />
    }
```





### 退出

在src\common\header\index.js中，点击退出时，这时的`actionCreators`组件不在头部，在login的store下的`actionCreators`,先调用组件

```JavaScript
import { actionCreators as loginActionCreators } from '../../pages/login/store'
```

```JavaScript
		logout() {
			dispatch(loginActionCreators.logout())
		}
```

在src\pages\login\store\actionCreators.js中

```JavaScript
export const logout = () => ({
	type: constants.LOGOUT,
	value: false
})
```



### 异步加载详情页面

安装

```
react-loadable
```

在src\pages\detail\loadable.js中

```JavaScript
import React from 'react';
import Loadable from 'react-loadable';

const LoadableComponent = Loadable({
  loader: () => import('./'),
  loading() {
  	return <div>正在加载</div>
  }
});

export default () => <LoadableComponent/>

```

在src\App.js中 更改detail路径

```JavaScript
import Detail from './pages/detail/loadable.js'

```

在src\pages\detail\index.js中加入`withRouter`组件

```JavaScript
import { withRouter } from 'react-router-dom'

```

在最后，让`Detail`能够获取`withRouter`里的所有内容

```JavaScript
export default connect(mapState, mapDispatch)(withRouter(Detail))

```



### 上线流程

安装xampp

然后启动Apache服务器

![image-20210202181409446](E:\前端自学\笔记\简书项目笔记\imgs\image-20210202181409446.png)



D:\xampp\htdocs 找到安装路径下的`htdocs`

删除多余的文件，新建一个api文件夹

在XAMPP点击Admin，或者在浏览器输入localhost

![image-20210202182758330](E:\前端自学\笔记\简书项目笔记\imgs\image-20210202182758330.png)

然后把前端模拟的api数据文件放到D:\xampp\htdocs的api文件夹下，前端api文件夹上线之前删掉



在vscode下关闭服务器，新建终端 

```javascript
npm run build
```



将生成的build文件夹下所有文件给后端，就是D:\xampp\htdocs 文件夹下



最后浏览器输入localhost:80  就上线成功了